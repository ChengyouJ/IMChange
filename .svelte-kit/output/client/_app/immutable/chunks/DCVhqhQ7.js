import{i as E,a as L,p as x,b as T}from"./jM1E5PI8.js";function D(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function g(t){const n=JSON.parse(t);return n.data&&(n.data=x(n.data,T.decoders)),n}function l(t){return HTMLElement.prototype.cloneNode.call(t)}function F(t,n=()=>{}){const u=async({action:a,result:o,reset:c=!0,invalidateAll:r=!0})=>{o.type==="success"&&(c&&HTMLFormElement.prototype.reset.call(t),r&&await E()),(location.origin+location.pathname===a.origin+a.pathname||o.type==="redirect"||o.type==="error")&&await L(o)};async function d(a){var f,b,h;if(((f=a.submitter)!=null&&f.hasAttribute("formmethod")?a.submitter.formMethod:l(t).method)!=="post")return;a.preventDefault();const c=new URL((b=a.submitter)!=null&&b.hasAttribute("formaction")?a.submitter.formAction:l(t).action),r=(h=a.submitter)!=null&&h.hasAttribute("formenctype")?a.submitter.formEnctype:l(t).enctype,s=new FormData(t,a.submitter),m=new AbortController;let p=!1;const y=await n({action:c,cancel:()=>p=!0,controller:m,formData:s,formElement:t,submitter:a.submitter})??u;if(p)return;let i;try{const e=new Headers({accept:"application/json","x-sveltekit-action":"true"});r!=="multipart/form-data"&&e.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(r)?r:"application/x-www-form-urlencoded");const A=r==="multipart/form-data"?s:new URLSearchParams(s),w=await fetch(c,{method:"POST",headers:e,cache:"no-store",body:A,signal:m.signal});i=g(await w.text()),i.type==="error"&&(i.status=w.status)}catch(e){if((e==null?void 0:e.name)==="AbortError")return;i={type:"error",error:e}}await y({action:c,formData:s,formElement:t,update:e=>u({action:c,result:i,reset:e==null?void 0:e.reset,invalidateAll:e==null?void 0:e.invalidateAll}),result:i})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",d),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",d)}}}export{F as a,D as e};
